RewriteLock /tmp/rewrite.lock

<VirtualHost saycheese.local.travail.jp>
    ServerName   saycheese.local.travail.jp
    DocumentRoot "/home/travail/git/saycheese/root"

    LogFormat    "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    CustomLog    /var/log/httpd/saycheese_local_access_log combined
    ErrorLog     /var/log/httpd/saycheese_error_log
    LogLevel     warn

    RewriteEngine On

    RewriteLogLevel 0
    RewriteRule ^/static/(.*) /static/$1 [L]
    RewriteMap url2thumbnail prg:/home/travail/git/saycheese/bin/rewrite_thumbnail.pl
    RewriteCond %{QUERY_STRING} !^$
    RewriteRule ^/(small|medium|large|original)/(.*) ${url2thumbnail:$1/$2?%{QUERY_STRING}} [L]
    RewriteRule ^/(small|medium|large|original)/(.*) ${url2thumbnail:$1/$2} [L]

    RewriteRule ^/(.*) http://192.168.1.2:3010/$1 [P,L]
</VirtualHost>
